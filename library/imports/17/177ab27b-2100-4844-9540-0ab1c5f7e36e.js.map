{"version":3,"sources":["assets/scripts/common/ListView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport TabItem from '../common/TabItem';\nimport APIDefine, { apis } from '../src/app/APIDefine';\nimport connect from \"../src/app/connect\";\nimport { AppDispatch, RootState } from \"../src/app/store\";\nimport wsgw from '../src/app/wsgw';\nimport { EAppPages, EAppPopups, IPageWithEffect, popPage, popPopup, pushPage, pushPopup } from \"../src/features/SliceApp\";\n\n\nconst { ccclass, property } = cc._decorator;\nexport class ListView extends cc.Component {\n    actions: any\n    props: any\n\n    @property(String)\n    public api: string = apis.getBalances;\n    @property(cc.ScrollView)\n    public scrollview: cc.ScrollView = null;\n    @property(cc.Node)\n    public content: cc.Node = null;\n    @property(cc.Node)\n    public item: cc.Node = null;\n    @property(Boolean)\n    public isPage: Boolean = false;\n\n    private offset = 0;\n    private needToFetch = true;\n    private limit = 30\n\n    onLoad() {\n        this.scrollview.node.on('bounce-bottom', () => this.fetch());\n    }\n\n    protected onDisable(): void {\n        this.content.removeAllChildren();\n        this.content.removeAllChildren();\n    }\n\n    onEnable() {\n        this.offset = 0;\n        this.limit = 0;\n        this.needToFetch = true;\n        this.fetch();\n    }\n\n    fetch() {\n        if (!this.needToFetch) return;\n        wsgw.userRequest(APIDefine[this.api], { offset: this.offset, limit: this.limit }, (e) => {\n            if (e.items.length < this.limit) this.needToFetch = false;\n            if (this.isPage) {\n                this.offset += 1;\n            } else {\n                this.offset += this.limit;\n            }\n            this.updateItems(e);\n        }, console.error);\n    }\n\n    updateItems(data) {\n        data.forEach((item, index) => {\n            this.addItem(item, index);\n        })\n    }\n\n    addItem(data: any, index: number) {\n        const newItem = cc.instantiate(this.item);\n        this.content.addChild(newItem);\n        newItem.getComponent(TabItem).init(data, index);\n    }\n}\nconst mapStateToProps = (state: RootState) => ({\n})\nconst mapDispatchToAction = (dispatch: AppDispatch) => ({\n    pushPage: (payload: EAppPages | IPageWithEffect) =>\n        dispatch(pushPage(payload)),\n    popPage: () => dispatch(popPage()),\n    pushPopup: (payload: EAppPopups) => dispatch(pushPopup(payload)),\n})\nexport default connect(mapStateToProps, mapDispatchToAction)(ListView)"]}