{"version":3,"sources":["assets/scripts/common/UserProfile.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { MsgSyncProfile } from \"@elofun/elo-services-myid-v2\";\nimport { EMsgTypes } from \"@elofun/elo-services-myid-v2/EMsgTypes\";\nimport APIDefine from \"../src/app/APIDefine\";\nimport store from \"../src/app/store\";\nimport wsgw from \"../src/app/wsgw\";\nimport { logEvent, setUserId, setUserProperties } from \"../src/common/Analytics\";\nimport { getCDN, isMyViettelDev } from \"../src/common/utils\";\nimport { syncBalances, syncProfile } from \"../src/features/SliceUser\";\nexport interface IUserProfilePayload {\n    userId: string;\n    avatarUrl: string;\n    msisdn: string;\n    accessToken: string;\n    scopes: Array<string>;\n    isNewUser: boolean;\n    customerType?: string;\n}\n\nexport interface IUserProfile {\n    userId: string;\n    avatar: string;\n    credential: string;\n    nickName: string;\n    coinBalance: number;\n    spinTicketBalance: number;\n    greenCashBalance: number;\n    wheelBalance: number;\n    language?: string;\n    isVip: boolean;\n    isRedeemInviteCode: boolean;\n    phoneNumber?: string\n    omsToken: string;\n    starBalance: number;\n    verifiedUser: boolean;\n}\nexport enum EUserProfileEventTypes {\n    SYNC = 'SYNC'\n}\n\nexport interface IUserBalancesPayload {\n    coinBalance: number,\n    turn: number,\n}\n\nexport class UserProfile extends cc.SystemEvent implements IUserProfile {\n    private userData: IUserProfile | any;\n    private logged: boolean;\n    constructor() {\n        super();\n    }\n\n    public isLogged() {\n        return this.logged;\n    }\n    public UpdateProfile(isUpdateInfor: boolean = false, success: Function = () => { }) {\n        wsgw.userRequest(APIDefine.getProfile, {}, (e) => {\n            const { info, profile } = e;\n\n            this.onSyncProfile({ ...info, ...profile })\n\n            success();\n        }, console.error);\n    }\n\n    public UpdateBalance(syncCoin = true) {\n        wsgw.userRequest(APIDefine.getBalances, {}, (e) => {\n            this.onSyncBalances(e, syncCoin)\n        }, console.error);\n    }\n\n    private onSyncProfile = (msg: IUserProfilePayload) => {\n        const {\n            userId,\n            avatarUrl,\n            msisdn,\n            accessToken,\n            customerType\n        } = msg;\n        this.userData = {\n            userId,\n            avatar: getCDN(avatarUrl || ''),\n            phoneNumber: msisdn,\n            omsToken: accessToken,\n            verifiedUser: customerType !== null && customerType !== \"-1\"),\n            ...msg,\n        };\n\n        this.logged = true;\n        // setUserId(`userId:${userId}`);\n        setUserProperties({\n            ...this.userData\n        });\n        console.log('login', this.userData)\n        store.dispatch(syncProfile(this.userData))\n    };\n\n    private onSyncBalances = (msg: IUserBalancesPayload, syncCoin = true) => {\n        const {\n            turn,\n            coinBalance,\n        } = msg;\n        const newCoinBalance = syncCoin ? coinBalance : this.userData.coinBalance\n        this.userData = {\n            ...this.userData,\n            spinTicketBalance: turn,\n            coinBalance: newCoinBalance,\n        };\n\n        setUserProperties({\n            ...this.userData\n        });\n        store.dispatch(syncBalances({\n            spinTicketBalance: turn,\n            coinBalance: newCoinBalance,\n        }))\n    };\n\n    public get() {\n        return { ...this.userData, isLogged: this.isLogged };\n    }\n\n    public get userId(): number {\n        return this.userData[`userId`];\n    }\n    public get credential(): string {\n        return this.userData[`credential`];\n    }\n    public get coinBalance(): number {\n        return this.userData[`coinBalance`];\n    }\n    public get starBalance(): number {\n        return this.userData[`starBalance`];\n    }\n    public get spinTicketBalance(): number {\n        return this.userData[`spinTicketBalance`];\n    }\n    public get nickName(): string {\n        return this.userData[`nickName`];\n    }\n    public get avatar(): string {\n        return getCDN(this.userData[`avatar`]);\n    }\n    public get language(): string {\n        return this.userData.language;\n    }\n    public get isVip(): boolean {\n        return !!this.userData.isVip;\n    }\n    public get isRedeemInviteCode(): boolean {\n        return !!this.userData.isRedeemInviteCode;\n    }\n    public get greenCashBalance(): number {\n        return this.userData[`greenCashBalance`];\n    }\n    public get wheelBalance(): number {\n        return this.userData[`wheelBalance`];\n    }\n    public get omsToken(): string {\n        return this.userData[`omsToken`];\n    }\n}\n\nexport const userProfile = new UserProfile();\n"]}