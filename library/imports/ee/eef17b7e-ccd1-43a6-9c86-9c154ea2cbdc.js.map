{"version":3,"sources":["assets/scripts/src/game/LoginProgressBar.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport * as R from 'ramda'\nimport FrameMgr from '../../common/FrameMgr';\nimport connect from \"../app/connect\";\nimport { RootState, AppDispatch } from \"../app/store\";\nimport { EAppPages, IPageWithEffect, pushPage, popPage, EAppPopups, pushPopup } from \"../features/SliceApp\";\n\nconst { ccclass, property } = cc._decorator;\n\nexport class LoginProgressBar extends cc.Component {\n    actions: any;\n    props: any\n\n    @property(cc.RichText)\n    descriptionTxt: cc.RichText = null;\n    @property(cc.Sprite)\n    icon: cc.Sprite = null;\n    @property(cc.ProgressBar)\n    progressBar: cc.ProgressBar = null;\n\n    onLoad() {\n        this.onStateChange()\n    }\n\n    onStateChange() {\n        const loginStreak = R.prop('loginStreak', this.props.login)\n        const milestones = R.prop('milestones', this.props.login)\n\n        const keys = R.keys(milestones);\n        const values = R.values(milestones);\n        const reachedMilestone = R.pipe(\n            R.values,\n            R.findLastIndex((milestone: number) => Number(loginStreak) - 1 >= milestone),\n            (i) => keys[i]?.toString(),\n        )(milestones || {})\n        const level = R.pipe(\n            R.split('_'),\n            R.last,\n            (levelStr: String) => {\n                const level = Number(levelStr);\n                return level <= 5 ? level : 5;\n            },\n        )(reachedMilestone || '')\n\n        if (loginStreak <= 0) {\n            this.icon.node.active = false;\n        } else if (loginStreak < R.last(values)) {\n            const expToLevelUp = Number(values[level]) - Number(values[level - 1]);\n            this.progressBar.progress = (loginStreak - values[level - 1]) / expToLevelUp;\n            this.icon.node.active = true;\n        } else {\n            this.progressBar.progress = 1;\n            this.icon.node.active = true;\n        }\n\n        this.descriptionTxt.string = R.replace('%s', loginStreak, '<color=#ffffff>Chuỗi đăng nhập </c><color=#FFE02D>%s</color><color=#ffffff> ngày</color>');\n        this.icon.spriteFrame = level > 0 && FrameMgr.Instance[`LOGIN_LEVEL_${level}`]\n    }\n}\n\nconst mapStateToProps = (state: RootState) => ({\n    login: state.login\n})\nconst mapDispatchToAction = (dispatch: AppDispatch) => ({\n    pushPage: (payload: EAppPages | IPageWithEffect) =>\n        dispatch(pushPage(payload)),\n    popPage: () => dispatch(popPage()),\n    pushPopup: (payload: EAppPopups) => dispatch(pushPopup(payload)),\n})\nexport default connect(mapStateToProps, mapDispatchToAction)(LoginProgressBar)\n"]}