{"version":3,"sources":["assets/scripts/Popups/PopupManager.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,8CAAyC;AAEzC,qDAAoE;AACpE,0CAAqC;AACrC,iCAA4B;AAEtB,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAE5C;IAAkC,gCAAK;IAAvC;QAAA,qEAuGC;QAnG8B,qBAAe,GAAY,IAAI,CAAC;QAChC,oBAAc,GAAY,IAAI,CAAC;QAC/B,iBAAW,GAAY,IAAI,CAAC;QAC1B,kBAAY,GAAqB,EAAE,CAAC;QAIzD,YAAM,GAAiB,EAAE,CAAA;;IA4FrC,CAAC;IA1FU,iBAAI,GAAX,UAAY,SAAqB,EAAE,KAAY;QAAZ,sBAAA,EAAA,YAAY;QAC3C,0CAA0C;QAC1C,IAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAM,KAAK,GAAG,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,qBAAU,CAAC,SAAS,CAAC,CAAC,CAAC;QAC5E,IAAI,KAAK,EAAE;YACP,6CAA6C;YAC7C,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACzB,QAAQ,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;YAC9B,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,KAAK,CAAC;SAC3C;IACL,CAAC;IAEM,gBAAG,GAAV,UAAW,MAAc;QAAd,uBAAA,EAAA,cAAc;QACrB,IAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAI,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YAC1C,IAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YACtF,QAAQ,CAAC,eAAe,CAAC,MAAM,GAAG,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC;YAC/E,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;SAC1C;IACL,CAAC;IAEM,iBAAI,GAAX,UAAY,SAAqB;QAC7B,IAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,cAAc,CAAC,qBAAU,CAAC,SAAS,CAAC,CAAC,CAAC;QACzE,IAAI,KAAK,EAAE;YACP,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;SAClC;IACL,CAAC;IAEM,qBAAQ,GAAf,UAAgB,SAAqB;QACjC,IAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAI,KAAK,GAAG,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,qBAAU,CAAC,SAAS,CAAC,CAAC,CAAC;QAC1E,IAAI,KAAK,EAAE;YACP,OAAO,KAAK,CAAC;SAChB;QACD,OAAO,QAAQ,CAAC,WAAW,CAAC,cAAc,CAAC,qBAAU,CAAC,SAAS,CAAC,CAAC,CAAC;IACtE,CAAC;IACO,8BAAO,GAAf,UAAgB,MAAe,EAAE,KAAc,EAAE,MAAuB;QAAxE,iBAuBC;QAvBgD,uBAAA,EAAA,cAAuB;QACpE,IAAI,CAAC,MAAM,EAAE;YACT,IAAI,YAAY,GAAG,CAAC,WAAW,EAAE,SAAS,EAAE,SAAS,CAAC,CAAA;YACtD,IAAI,MAAM,GAAG,YAAY,CAAC,gBAAM,CAAC,OAAO,CAAC,CAAC,EAAE,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAA;YACrE,IAAI,MAAM,EAAE;gBACR,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;gBACxB,OAAO;aACV;YACD,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC;iBACV,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,CAAC,GAAG,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC;iBAC5C,IAAI,CAAC;gBACF,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;gBACxB,sEAAsE;YAC1E,CAAC,CAAC;iBACD,KAAK,EAAE,CAAA;SACf;aAAM;YACH,IAAI,YAAY,GAAG,CAAC,WAAW,EAAE,SAAS,EAAE,SAAS,CAAC,CAAA;YACtD,IAAI,MAAM,GAAG,YAAY,CAAC,gBAAM,CAAC,OAAO,CAAC,CAAC,EAAE,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAA;YACrE,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAA;YACjB,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC;iBACV,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,CAAC,GAAG,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;iBAC1C,KAAK,EAAE,CAAA;SACf;IACL,CAAC;IAEO,+BAAQ,GAAhB,UAAiB,KAAc;QAC3B,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAC9C,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IACrC,CAAC;IAEO,kCAAW,GAAnB,UAAoB,KAAc;QAC9B,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAC3C,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IACxC,CAAC;IAED,6BAAM,GAAN;QACI,YAAY,CAAC,QAAQ,GAAG,IAAI,CAAC;QAC7B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC/C,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SACtE;IACL,CAAC;IACD,oCAAa,GAAb;QACI,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE;YACnD,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAA;SAC7E;aACI,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE;YACxD,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;YAC5C,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW,EAAE;gBAC5B,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC;aAC/B;SACJ;QACD,IAAI,CAAC,MAAM,kBAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;IAC5C,CAAC;IAlGkB;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;yDAAyC;IACxC;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;wDAAwC;IACvC;QAAlB,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;qDAAqC;IAClC;QAApB,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;sDAA6C;IAgGrE,mBAAC;CAvGD,AAuGC,CAvGiC,eAAK,GAuGtC;AAvGY,oCAAY;AAwGzB,IAAM,eAAe,GAAG,UAAC,KAAgB,IAAK,OAAA,CAAC;IAC3C,GAAG,EAAE,KAAK,CAAC,GAAG;CACjB,CAAC,EAF4C,CAE5C,CAAA;AACF,IAAM,mBAAmB,GAAG,UAAC,QAAqB,IAAK,OAAA,CAAC;IACpD,YAAY,EAAE,cAAM,OAAA,QAAQ,CAAC,uBAAY,EAAE,CAAC,EAAxB,CAAwB;CAC/C,CAAC,EAFqD,CAErD,CAAA;AACF,kBAAe,iBAAO,CAAC,eAAe,EAAE,mBAAmB,CAAC,CAAC,YAAY,CAAC,CAAA","file":"","sourceRoot":"/","sourcesContent":["import SoundMgr from \"../common/SoundMgr\";\nimport connect from \"../src/app/connect\";\nimport { AppDispatch, RootState } from \"../src/app/store\";\nimport { EAppPopups, removeEffect } from \"../src/features/SliceApp\";\nimport Helper from \"../utils/Helper\";\nimport Popup from \"./Popup\";\n\nconst { ccclass, property } = cc._decorator;\n\nexport class PopupManager extends Popup {\n\n    actions: any;\n    props: RootState;\n    @property(cc.Node) private PopupBackground: cc.Node = null;\n    @property(cc.Node) private PopupContainer: cc.Node = null;\n    @property(cc.Node) private ShownPopups: cc.Node = null;\n    @property(cc.Prefab) private PopupPrefabs: Array<cc.Prefab> = [];\n\n    private mShowCallback;\n    private mHideCallback;\n    private popups: EAppPopups[] = []\n    static Instance: PopupManager;\n    static push(popupName: EAppPopups, useBg = true) {\n        // const SoundInstance = SoundMgr.Instance\n        const instance = this.Instance;\n        const popup = instance.PopupContainer.getChildByName(EAppPopups[popupName]);\n        if (popup) {\n            // SoundMgr.playSfx(SoundInstance.SFX_POPUP);\n            instance.usePopup(popup);\n            instance.animate(true, popup);\n            instance.PopupBackground.active = useBg;\n        }\n    }\n\n    static pop(isFade = false) {\n        const instance = this.Instance;\n        if (instance.ShownPopups.children.length > 0) {\n            const popup = instance.ShownPopups.children[instance.ShownPopups.children.length - 1];\n            instance.PopupBackground.active = instance.ShownPopups.children.length - 1 > 0;\n            instance.animate(false, popup, isFade);\n        }\n    }\n\n    static hide(popupName: EAppPopups) {\n        const instance = this.Instance;\n        const popup = instance.ShownPopups.getChildByName(EAppPopups[popupName]);\n        if (popup) {\n            instance.animate(false, popup);\n        }\n    }\n\n    static getPopup(popupName: EAppPopups) {\n        const instance = this.Instance;\n        let popup = instance.PopupContainer.getChildByName(EAppPopups[popupName]);\n        if (popup) {\n            return popup;\n        }\n        return instance.ShownPopups.getChildByName(EAppPopups[popupName]);\n    }\n    private animate(isShow: boolean, popup: cc.Node, isFade: boolean = false) {\n        if (!isShow) {\n            let randomEasing = ['bounceOut', 'quadOut', 'backOut']\n            let easing = randomEasing[Helper.RandInt(0, randomEasing.length - 1)]\n            if (isFade) {\n                this.returnPopup(popup);\n                return;\n            }\n            cc.tween(popup)\n                .to(0.3, { scale: 0, }, { easing: 'quadIn' })\n                .call(() => {\n                    this.returnPopup(popup);\n                    // this.PopupBackground.active = this.ShownPopups.children.length > 0;\n                })\n                .start()\n        } else {\n            let randomEasing = ['bounceOut', 'quadOut', 'backOut']\n            let easing = randomEasing[Helper.RandInt(0, randomEasing.length - 1)]\n            popup.setScale(0)\n            cc.tween(popup)\n                .by(0.3, { scale: 1, }, { easing: easing })\n                .start()\n        }\n    }\n\n    private usePopup(popup: cc.Node) {\n        this.PopupContainer.removeChild(popup, false);\n        this.ShownPopups.addChild(popup);\n    }\n\n    private returnPopup(popup: cc.Node) {\n        this.ShownPopups.removeChild(popup, false);\n        this.PopupContainer.addChild(popup);\n    }\n\n    onLoad() {\n        PopupManager.Instance = this;\n        for (let i = 0; i < this.PopupPrefabs.length; i++) {\n            this.PopupContainer.addChild(cc.instantiate(this.PopupPrefabs[i]));\n        }\n    }\n    onStateChange() {\n        if (this.popups.length < this.props.app.popups.length) {\n            PopupManager.push(this.props.app.popups[this.props.app.popups.length - 1])\n        }\n        else if (this.popups.length > this.props.app.popups.length) {\n            PopupManager.pop(this.props.app.popupEffect)\n            if (this.props.app.popupEffect) {\n                this.actions.removeEffect();\n            }\n        }\n        this.popups = [...this.props.app.popups]\n    }\n}\nconst mapStateToProps = (state: RootState) => ({\n    app: state.app\n})\nconst mapDispatchToAction = (dispatch: AppDispatch) => ({\n    removeEffect: () => dispatch(removeEffect())\n})\nexport default connect(mapStateToProps, mapDispatchToAction)(PopupManager)"]}