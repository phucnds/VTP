{"version":3,"sources":["assets/scripts/components/CompAvatar.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { getCDN } from \"../src/common/utils\";\n\nconst { ccclass, property, executeInEditMode } = cc._decorator;\n\n@ccclass // <= remove it if using connect\n@executeInEditMode\nexport default class CompAvatar extends cc.Component\n{\n\n    @property(Number) customSize: number = 0\n    private avatarURL: string = \"\";\n    // onLoad () {}\n\n    start()\n    {\n        if (this.customSize > 0)\n        {\n            this.changeSize()\n        }\n    }\n    changeSize()\n    {\n        this.node.setScale(this.customSize / this.node.width)\n    }\n    onEnable()\n    {\n        let avatar = cc.find(\"avt\", this.node) || cc.find(\"Mask/avt\", this.node)\n        avatar && avatar.setContentSize(80, 80);\n    }\n    updateAvatar(url: string | cc.SpriteFrame, isDebug = false)\n    {\n        // url = \"https://elo-games.elofun.com/avatars/+(119).png\"\n        if (typeof url == \"string\")\n        {\n            if (url != this.avatarURL && url.startsWith(\"http\"))\n            {\n                this.avatarURL = getCDN(url)\n                let avatar = cc.find(\"avt\", this.node) || cc.find(\"Mask/avt\", this.node)\n                let avtSprite = avatar.getComponent(cc.Sprite)\n                if (avatar && avtSprite)\n                {\n                    cc.assetManager.loadRemote(getCDN(url), (err: any, tex: any) =>\n                    {\n                        if (avatar && !err)\n                        {\n                            avatar.setScale(1)\n                            avtSprite.spriteFrame = err ? null : new cc.SpriteFrame(tex);\n                            avatar.setContentSize(80, 80);\n                        }\n                        else\n                        {\n                            console.error(err)\n                        }\n                    });\n                }\n            }\n        }\n        else\n        {\n            let avatar = cc.find(\"avt\", this.node) || cc.find(\"Mask/avt\", this.node)\n            let avtSprite = avatar.getComponent(cc.Sprite)\n            if (avatar && avtSprite)\n            {\n                avtSprite.spriteFrame = url\n                setTimeout(() => {\n                    avatar.setContentSize(80, 80);\n                }, 200);\n            }\n        }\n    }\n    activeOpponentAvatar(isActive: boolean)\n    {\n        let avatar = cc.find(\"avt\", this.node) || cc.find(\"Mask/avt\", this.node)\n        let question = cc.find(\"icon-question\", this.node) || cc.find(\"Mask/icon-question\", this.node)\n\n        avatar.active = isActive\n        if (question) question.active = !isActive\n    }\n    getAvtURL()\n    {\n        return this.avatarURL\n    }\n    // update (dt) {}\n}\n"]}