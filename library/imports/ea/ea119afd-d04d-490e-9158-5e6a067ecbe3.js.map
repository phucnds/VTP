{"version":3,"sources":["assets/scripts/src/game/Gift.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import FrameMgr from \"../../common/FrameMgr\";\nimport Helper from \"../../utils/Helper\";\nimport GameDefine from \"../common/GameDefine\";\nimport { randomInt } from \"../common/utils\";\nimport PathFollowObject from \"../Path/PathFollowObject\";\nimport GameMgr, { GameStates } from \"./GameMgr\";\nimport GiftMgr from \"./GiftsMgr\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Gift extends PathFollowObject {\n    @property(cc.Node)\n    public container: cc.Node = null;\n    @property(cc.Node)\n    public topView: cc.Node = null;\n    @property(cc.Node)\n    public cover: cc.Node = null;\n    @property(cc.Node)\n    public ui: cc.Node = null;\n    @property(cc.Node)\n    public selectPoint: cc.Node = null;\n    @property(cc.Node)\n    public btnClose: cc.Node = null;\n    @property(cc.Sprite)\n    public sprite: cc.Sprite = null;\n\n    private isChosen = false;\n    private clickable = true;\n\n    protected onLoad(): void {\n        // Helper.registerButtonEvent(this.sprite.node, () => {\n        //     if (!this.clickable) return;\n        //     GameMgr.Instance.setGameState(GameStates.OPEN_BOX);\n\n        //     this.isChosen = true;\n        //     this.clickable = false;\n        //     this.node.parent = this.topView;\n\n        //     cc.tween(this.cover)\n        //         .set({ opacity: 0, active: true })\n        //         .to(\n        //             GameDefine.GIFT_CHOSEN_ANIM_TIME,\n        //             { opacity: 170 },\n        //             { easing: 'quartOut' }\n        //         )\n        //         .start();\n\n\n        //     cc.tween(this.node)\n        //         .set({ scale: 1 })\n        //         .to(\n        //             GameDefine.GIFT_CHOSEN_ANIM_TIME,\n        //             { scale: GameDefine.GIFT_CHOSEN_SCALE, position: cc.Vec3.ZERO },\n        //             { easing: 'quartOut' }\n        //         )\n        //         .call(() => {\n        //             this.ui.active = true;\n        //         })\n        //         .start();\n        // })\n\n        Helper.registerButtonEvent(this.btnClose, () => {\n            GameMgr.Instance.setGameState(GameStates.PLAYING);\n            this.close()\n        })\n        this.init();\n    }\n\n    pickSelf() {\n        GameMgr.Instance.setGameState(GameStates.SELECT);\n        this.isChosen = true;\n        this.clickable = false;\n    }\n\n    init() {\n        this.isChosen = false;\n        this.clickable = true;\n        this.cover.active = false;\n        this.sprite.node.active = true;\n        this.node.scale = 1;\n        this.sprite.spriteFrame = FrameMgr.Instance.GIFT_FRAMES[randomInt(0, FrameMgr.Instance.GIFT_FRAMES.length)];\n    }\n\n    setSpeed(speed: number) {\n        const passedDistance = this.speed * this.time;\n        this.speed = speed;\n        this.time = this.pos ? passedDistance / this.speed : 0;\n    }\n    update(dt) {\n        if (!this.running) return;\n        if (\n            GameMgr.Instance.getGameState() !== GameStates.PLAYING &&\n            GameMgr.Instance.getGameState() !== GameStates.ROLLING &&\n            GameMgr.Instance.getGameState() !== GameStates.SELECT\n        ) {\n            return;\n        } else {\n            if (!this.initiated) {\n                // this.timer += dt;\n                // if ((this.timer * this.speed) < this.delay) {\n                //     return\n                // } else {\n                this.initiate();\n                // };\n            }\n        }\n\n        if (GameMgr.Instance.getGameState() === GameStates.ROLLING) {\n            if (this.speed > GameDefine.GIFT_SPEED_MIN) {\n                this.setSpeed(this.speed - GameDefine.GIFT_BREAK_A * dt * dt);\n            } else {\n                this.setSpeed(GameDefine.GIFT_SPEED_MIN);\n                GiftMgr.Instance.choose();\n            }\n        } else if (GameMgr.Instance.getGameState() === GameStates.PLAYING) {\n            this.setSpeed(GameDefine.GIFT_SPEED);\n        };\n\n        this.time += dt;\n        if (this.time > this.distance / this.speed) {\n            this.time = 0;\n            this.initNextPoint()\n            if (this.nextPoint === this.path.getStartPoint()) {\n                this.completeLapCallback();\n            }\n        }\n\n        const direction = this.GetBezierPosition(this.time / (this.distance / this.speed)).sub(this.pos).normalize();\n        this.pos = this.pos.add(direction.mul(this.speed).mul(dt));\n        this.node.setPosition(this.pos);\n        if (this.isChosen && GameMgr.Instance.getGameState() === GameStates.SELECT) {\n            if (this.currentPoint === this.selectPoint) {\n                GameMgr.Instance.setGameState(GameStates.PICK_UP);\n\n                setTimeout(() => {\n                    this.isChosen = true;\n                    this.clickable = false;\n                    this.node.parent = this.topView;\n\n                    cc.tween(this.cover)\n                        .set({ opacity: 0, active: true })\n                        .to(\n                            GameDefine.GIFT_CHOSEN_ANIM_TIME,\n                            { opacity: 170 },\n                            { easing: 'quartOut' }\n                        )\n                        .start();\n\n\n                    cc.tween(this.node)\n                        .set({ scale: 1 })\n                        .to(\n                            GameDefine.GIFT_CHOSEN_ANIM_TIME,\n                            { scale: GameDefine.GIFT_CHOSEN_SCALE, position: cc.Vec3.ZERO },\n                            { easing: 'quartOut' }\n                        )\n                        .call(() => {\n                            this.ui.active = true;\n                        })\n                        .start();\n                }, 1000)\n            }\n        }\n    }\n\n    completeLapCallback() {\n        if (!this.loop) {\n            this.initiate()\n        }\n\n        if (this.isChosen) {\n            return\n        };\n\n        this.sprite.node.active = true;\n        this.sprite.spriteFrame = FrameMgr.Instance.GIFT_FRAMES[randomInt(0, FrameMgr.Instance.GIFT_FRAMES.length)];\n    }\n\n    close() {\n        this.node.parent = this.container;\n        this.cover.active = false;\n        this.ui.active = false;\n        this.sprite.node.active = false;\n        this.node.scale = 1;\n        this.isChosen = false;\n        this.clickable = true;\n    }\n}\n"]}