{"version":3,"sources":["assets/scripts/src/game/RewardPopupsMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport * as R from 'ramda'\nimport { userProfile } from '../../common/UserProfile';\nimport { Missions } from '../../components/CompQuestsContainer';\nimport PopupBuyTurnSuccess from '../../Popups/PopupBuyTurnSuccess';\nimport PopupCompleteQuest from '../../Popups/PopupCompleteQuest';\nimport PopupWeeklyWinner from '../../Popups/PopupWeeklyWinner';\nimport SingletonNode from \"../../utils/SingletonNode\";\nimport APIDefine from '../app/APIDefine';\nimport connect from '../app/connect';\nimport store, { AppDispatch, RootState } from '../app/store';\nimport wsgw from '../app/wsgw';\nimport { checkRewardPopup } from '../common/common';\nimport { EAppPages, EAppPopups, IPageWithEffect, popPage, pushPage, pushPopup } from '../features/SliceApp';\nimport { syncQuests } from '../features/SliceQuests';\n\nconst { ccclass, property } = cc._decorator;\n\nexport enum ETopupType {\n    MO_GAME = 'MO_GAME',\n    MO_GAME_LAN_DAU = 'MO_GAME_LAN_DAU',\n    DOI_DIEM_VT_PLUS = 'DOI_DIEM_VT_PLUS',\n    MUA_LUOT = 'MUA_LUOT',\n    PHAN_THUONG_TRONG_GAME = 'PHAN_THUONG_TRONG_GAME',\n    KHAC = 'KHAC',\n    WEEKLY_REWARD = 'WEEKLY_REWARD',\n}\n\nexport class RewardPopupsMgr extends SingletonNode<RewardPopupsMgr>() {\n    actions: any;\n    props: any\n\n    private rewardPopups: Array<any>;\n\n    setData(data) {\n        this.rewardPopups = data;\n    }\n\n    onLoad(): void {\n        super.onLoad();\n\n        wsgw.subscribeCompleteMission((data) => {\n            const { type, msisdn } = data;\n            if (type === Missions.CHIA_SE_GAME.toString()) return;\n            if (msisdn !== this.props.user.msisdn) return;\n\n            setTimeout(() => {\n                userProfile.UpdateProfile(true, () => {\n                    wsgw.userRequest(APIDefine.getMissionList, {}, (e) => {\n                        store.dispatch(syncQuests(e));\n                    }, console.error);\n                    checkRewardPopup()\n                    userProfile.UpdateBalance();\n                });\n            }, 1000);\n\n        })\n        wsgw.subscribeBuyTurn((data) => {\n            const { msisdn } = data;\n            if (msisdn !== this.props.user.msisdn) return;\n\n            setTimeout(() => {\n                wsgw.userRequest(APIDefine.getMissionList, {}, (e) => {\n                    store.dispatch(syncQuests(e));\n                }, console.error);\n                checkRewardPopup()\n                userProfile.UpdateBalance();\n            }, 1000);\n        })\n    }\n\n    showPopup() {\n        const item = R.last(this.rewardPopups);\n        if (!item) return;\n\n        this.rewardPopups = R.dropLast(1, this.rewardPopups);\n        const {\n            data: {\n                turn, coin\n            },\n            type,\n        } = item;\n\n        if (type === ETopupType.DOI_DIEM_VT_PLUS || type === ETopupType.MUA_LUOT) {\n            store.dispatch(pushPopup(EAppPopups.PopupBuyTurnSuccess));\n            const popup = cc.find('Canvas/PopupManager/Shown Popups/PopupBuyTurnSuccess');\n            popup && popup.getComponent(PopupBuyTurnSuccess).init(turn)\n        } else if (type === ETopupType.WEEKLY_REWARD) {\n            store.dispatch(pushPopup(EAppPopups.PopupWeeklyWinner));\n        } else {\n            store.dispatch(pushPopup(EAppPopups.PopupCompleteQuest));\n            const popup = cc.find('Canvas/PopupManager/Shown Popups/PopupCompleteQuest');\n            popup && popup.getComponent(PopupCompleteQuest).init(turn, coin)\n        }\n    }\n}\n\nconst mapStateToProps = (state: RootState) => ({\n    user: state.user\n})\nconst mapDispatchToAction = (dispatch: AppDispatch) => ({\n    pushPage: (payload: EAppPages | IPageWithEffect) =>\n        dispatch(pushPage(payload)),\n    popPage: () => dispatch(popPage()),\n    pushPopup: (payload: EAppPopups) => dispatch(pushPopup(payload)),\n})\nexport default connect(mapStateToProps, mapDispatchToAction)(RewardPopupsMgr)\n"]}