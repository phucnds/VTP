{"version":3,"sources":["assets/scripts/src/game/GiftsMgr.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAElF,2DAAsD;AAEtD,yCAAmD;AAEnD,qCAAgD;AAChD,+BAA0B;AAEpB,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAAqC,2BAAwB;IAA7D;QAAA,qEAiDC;QA/CG,cAAQ,GAAY,IAAI,CAAC;QAEzB,aAAO,GAAY,IAAI,CAAC;QAExB,eAAS,GAAY,IAAI,CAAC;QAE1B,iBAAW,GAAW,CAAC,CAAC;;IAyC5B,CAAC;IAvCG,sBAAI,GAAJ;QACI,oCAAoC;QACpC,iCAAiC;QACjC,+CAA+C;QAC/C,qDAAqD;QACrD,8EAA8E;QAC9E,mCAAmC;QACnC,6BAA6B;QAC7B,IAAI;IACR,CAAC;IAED,sBAAI,GAAJ;QACI,IAAI,iBAAO,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,oBAAU,CAAC,OAAO;YAAE,OAAO;QACnE,iBAAO,CAAC,QAAQ,CAAC,YAAY,CAAC,oBAAU,CAAC,OAAO,CAAC,CAAC;IACtD,CAAC;IAED,wBAAM,GAAN;QAAA,iBAsBC;QArBG,IAAI,iBAAO,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,oBAAU,CAAC,OAAO;YAAE,OAAO;QACnE,IAAI,SAAS,GAAG,IAAI,CAAC;QACrB,IAAI,WAAW,GAAG,MAAM,CAAC;QACzB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,IAAI;YAC5B,IAAM,OAAO,GAAG,wBAAgB,CAAC,IAAI,CAAC,CAAC;YACvC,IAAM,YAAY,GAAG,wBAAgB,CAAC,KAAI,CAAC,SAAS,CAAC,CAAC;YAEtD,IAAI,OAAO,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,EAAE;gBAC5B,OAAO;aACV;YAED,IAAM,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,GAAG,EAAE,CAAC;YACjD,IAAI,QAAQ,GAAG,WAAW,EAAE;gBACxB,WAAW,GAAG,QAAQ,CAAC;gBACvB,SAAS,GAAG,IAAI,CAAC;aACpB;QACL,CAAC,CAAC,CAAA;QAEF,IAAI,SAAS,EAAE;YACX,SAAS,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC,QAAQ,EAAE,CAAC;SAC3C;IACL,CAAC;IA9CD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;6CACO;IAEzB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;4CACM;IAExB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;8CACQ;IAE1B;QADC,QAAQ,CAAC,MAAM,CAAC;gDACO;IARP,OAAO;QAD3B,OAAO;OACa,OAAO,CAiD3B;IAAD,cAAC;CAjDD,AAiDC,CAjDoC,uBAAa,EAAW,GAiD5D;kBAjDoB,OAAO","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport SingletonNode from \"../../utils/SingletonNode\";\nimport GameDefine from \"../common/GameDefine\";\nimport { getWorldPosition } from \"../common/utils\";\nimport PathFollowObject from \"../Path/PathFollowObject\";\nimport GameMgr, { GameStates } from \"./GameMgr\";\nimport Gift from \"./Gift\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GiftMgr extends SingletonNode<GiftMgr>() {\n    @property(cc.Node)\n    template: cc.Node = null;\n    @property(cc.Node)\n    topView: cc.Node = null;\n    @property(cc.Node)\n    indicator: cc.Node = null;\n    @property(Number)\n    numbOfGifts: Number = 0;\n\n    init() {\n        // this.topView.removeAllChildren();\n        // this.node.removeAllChildren();\n        // for (let i = 0; i < this.numbOfGifts; i++) {\n        //     const newGift = cc.instantiate(this.template);\n        //     newGift.getComponent(PathFollowObject).Delay = i * GameDefine.GIFT_GAP;\n        //     this.node.addChild(newGift);\n        //     newGift.active = true;\n        // }\n    }\n\n    roll() {\n        if (GameMgr.Instance.getGameState() !== GameStates.PLAYING) return;\n        GameMgr.Instance.setGameState(GameStates.ROLLING);\n    }\n\n    choose() {\n        if (GameMgr.Instance.getGameState() !== GameStates.ROLLING) return;\n        let chosenOne = null;\n        let minDistance = 999999;\n        this.node.children.forEach((gift) => {\n            const giftPos = getWorldPosition(gift);\n            const indicatorPos = getWorldPosition(this.indicator);\n\n            if (giftPos.y < indicatorPos.y) {\n                return;\n            }\n\n            const distance = giftPos.sub(indicatorPos).mag();\n            if (distance < minDistance) {\n                minDistance = distance;\n                chosenOne = gift;\n            }\n        })\n\n        if (chosenOne) {\n            chosenOne.getComponent(Gift).pickSelf();\n        }\n    }\n}\n"]}