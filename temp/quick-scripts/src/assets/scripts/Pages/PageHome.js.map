{"version":3,"sources":["assets/scripts/Pages/PageHome.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport * as R from 'ramda'\nimport { Console } from \"console\";\nimport LoadingCover from \"../common/LoadingCover\";\nimport SoundMgr from \"../common/SoundMgr\";\nimport TopUI, { EAppTopUIs } from \"../common/TopUI\";\nimport { userProfile, UserProfile } from \"../common/UserProfile\";\nimport { CompQuestsContainer } from \"../components/CompQuestsContainer\";\nimport PopupManager from \"../Popups/PopupManager\";\nimport APIDefine from \"../src/app/APIDefine\";\nimport connect from \"../src/app/connect\";\nimport store, { RootState, AppDispatch } from \"../src/app/store\";\nimport wsgw from \"../src/app/wsgw\";\nimport GameDefine from \"../src/common/GameDefine\";\nimport { EAppPages, IPageWithEffect, pushPage, popPage, EAppPopups, pushPopup, PAGE_SHOW_EFFECT } from \"../src/features/SliceApp\";\nimport { syncLoginMilestones, syncLoginStreak } from \"../src/features/SliceLogin\";\nimport { LoginProgressBar } from \"../src/game/LoginProgressBar\";\nimport Helper from \"../utils/Helper\";\nimport Page from \"./Page\";\nimport { syncQuests } from '../src/features/SliceQuests';\nimport { syncReward } from '../src/features/SliceReward';\nimport { syncWeeklyTicket } from '../src/features/SliceWeeklyTicket';\nimport PopupDailyLogin from '../Popups/PopupDailyLogin';\nimport MachineLightFX from '../src/game/MachineLightFX';\nimport TrackingDefine from '../src/common/TrackingDefine';\nimport { trackUserInteract } from '../src/common/utils';\nimport RewardPopupsMgr from '../src/game/RewardPopupsMgr';\nimport { checkRewardPopup } from '../src/common/common';\nimport PopupNewUserReward from '../Popups/PopupNewUserReward';\nimport { syncDeeplinks } from '../src/features/SliceDeeplinks';\nimport { PageRules } from './PageRules';\nimport GameMgr from '../src/game/GameMgr';\n\nconst { ccclass, property } = cc._decorator;\n\nexport class PageHome extends Page {\n    actions: any;\n    props: any\n    @property(cc.Node)\n    public btnLeaderboard: cc.Node = null;\n\n    @property(cc.Node) btnRules: cc.Node = null;\n    @property(cc.Node) btnOrder: cc.Node = null;\n    @property(cc.Node) btnShare: cc.Node = null;\n\n    @property(cc.Node) bgDay: cc.Node = null;\n    @property(cc.Node) bgNight: cc.Node = null;\n\n    private curHour: number = 0\n\n    claimLoginReward(newUserCoin, newUserTurn, initFunc: Function = () => { }, fail: Function = () => { }, retry = 45) {\n        if (retry < 0) {\n            // this.actions.pushPopup(EAppPopups.PopupErrorReload);\n            return\n        }\n        wsgw.userRequest(APIDefine.claimLoginReward, {}, (e) => {\n            userProfile.UpdateBalance();\n            store.dispatch(syncLoginStreak(e));\n            if (e.message) return;\n\n            const { coin: loginCoin, turn: loginTurn, loginStreak } = e;\n            initFunc(newUserCoin + loginCoin, newUserTurn + loginTurn, loginStreak)\n        }, (e) => {\n            if (e.status === 409) return;\n            fail();\n            setTimeout(() => this.claimLoginReward(newUserCoin, newUserTurn, initFunc, fail, retry - 1), 1000);\n            console.error(e)\n        });\n    }\n\n    onLoad() {\n        GameMgr.Instance.init();\n\n        userProfile.UpdateProfile(true, () => {\n            wsgw.userRequest(APIDefine.claimNewUserRewards, {}, (e) => {\n                userProfile.UpdateBalance();\n                const { coin: newUserCoin, turn: newUserTurn } = e;\n                this.claimLoginReward(newUserCoin, newUserTurn, (coin, turn) => {\n                    this.actions.pushPopup(EAppPopups.PopupNewUserReward);\n                    const popup = cc.find('Canvas/PopupManager/Shown Popups/PopupNewUserReward');\n                    popup && popup.getComponent(PopupNewUserReward).init(coin, turn);\n                });\n            }, () => {\n                if (!this.props.user.isNewUser) {\n                    this.claimLoginReward(\n                        0,\n                        0,\n                        (coin, turn, loginStreak) => {\n                            this.actions.pushPopup(EAppPopups.PopupDailyLogin);\n                            const popup = cc.find('Canvas/PopupManager/Shown Popups/PopupDailyLogin');\n                            popup && popup.getComponent(PopupDailyLogin).init(coin, turn, loginStreak);\n                        },\n                    );\n                } else {\n                    // this.actions.pushPopup(EAppPopups.PopupErrorReload);\n                }\n            });\n\n            wsgw.userRequest(APIDefine.getMissionList, {}, (e) => {\n                store.dispatch(syncQuests(e));\n            }, console.error);\n            wsgw.userRequest(APIDefine.getDeeplinks, {}, (e) => {\n                store.dispatch(syncDeeplinks(e));\n            }, console.error);\n            wsgw.userRequest(APIDefine.getLoginMilestones, {}, (e) => {\n                store.dispatch(syncLoginMilestones(e.milestones));\n            }, console.error);\n            wsgw.userRequest(APIDefine.checkWeeklyTicket, {}, (e) => {\n                store.dispatch(syncWeeklyTicket({ bought: true }))\n            }, console.error);\n            checkRewardPopup();\n        });\n\n        SoundMgr.playMusic(SoundMgr.Instance.BGM);\n\n        this.initButtons();\n\n        this.btnRules.on(cc.Node.EventType.TOUCH_END, (e) => {\n            this.actions.pushPage(EAppPages.PageRules);\n        })\n\n        this.btnOrder.on(cc.Node.EventType.TOUCH_END, this.onOrder.bind(this))\n        this.btnShare.on(cc.Node.EventType.TOUCH_END, this.onShare.bind(this))\n\n        this.setBg()\n        this.schedule(function() {\n            this.setBg();\n        }, 5);\n    }\n\n    onOrder() {\n        if ((<any>window).ReactNativeWebView) {\n            (<any>window).ReactNativeWebView.postMessage('ON_CREATE_ORDER', '*')\n        } else {\n            window.postMessage('ON_CREATE_ORDER', '*')\n        }\n    }\n\n    onShare() {\n        if ((<any>window).ReactNativeWebView) {\n            (<any>window).ReactNativeWebView.postMessage('ON_SHARE_GAME', '*')\n        } else {\n            window.postMessage('ON_SHARE_GAME', '*')\n        }\n    }\n\n    initButtons() {\n        Helper.registerButtonEvent(this.btnLeaderboard, () => {\n            this.actions.pushPopup(EAppPopups.PopupLeaderboard);\n        })\n    }\n\n    start() {\n        \n    }\n\n    update(dt) {\n        \n    }\n\n    updateBalance(spinBalance: number, coinBalance: number) {\n    }\n\n    init() {\n        super.init();\n        TopUI.Instance.show(EAppTopUIs.CompHeader, true, true)\n\n        userProfile.UpdateBalance();\n    }\n    protected onDisable(): void {\n        TopUI.Instance.show(EAppTopUIs.CompHeaderSimple, true, true)\n    }\n\n    onStateChange() {\n    }\n\n    setBg(){\n        const d = new Date();\n        let hour = d.getHours();\n\n        if(hour >= 6 && hour < 18){\n            console.log(\"Day\")\n            this.bgDay.active = true\n            this.bgNight.active = false\n        }else{\n            console.log(\"Night\")\n            this.bgDay.active = false\n            this.bgNight.active = true\n        }\n\n        \n    }\n\n\n\n    \n}\nconst mapStateToProps = (state: RootState) => ({\n    user: state.user\n})\nconst mapDispatchToAction = (dispatch: AppDispatch) => ({\n    pushPage: (payload: EAppPages | IPageWithEffect) =>\n        dispatch(pushPage(payload)),\n    popPage: () => dispatch(popPage()),\n    pushPopup: (payload: EAppPopups) => dispatch(pushPopup(payload)),\n})\nexport default connect(mapStateToProps, mapDispatchToAction)(PageHome)"]}